Random effects demo
================

\#Loading

``` r
library(lmerTest)
```

    ## Loading required package: lme4

    ## Loading required package: Matrix

    ## 
    ## Attaching package: 'lmerTest'

    ## The following object is masked from 'package:lme4':
    ## 
    ##     lmer

    ## The following object is masked from 'package:stats':
    ## 
    ##     step

``` r
library(tidyverse)
```

    ## Warning: package 'lubridate' was built under R version 4.4.1

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ tidyr::expand() masks Matrix::expand()
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ✖ tidyr::pack()   masks Matrix::pack()
    ## ✖ tidyr::unpack() masks Matrix::unpack()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

Today we will be using a subset of data published in Menalled et
al. (2023): <https://doi.org/10.1038/s41598-023-43987-x>

This experiment looks at changes in weed communities across 10 cover
crop treatments (5 summer cover crop treatments, 5 winter cover crop
treatments). Today, we will just work with winter cover crops
(i.e. tilled control, canola, cereal rye (CR), hairy vetch (HV), and HV
x CR mix).

Here is a nice picture of the map and experimental design of the data we
are working with today

<img src="Example_MapDesign.png" width="452" />

``` r
#Each year is stored separately, I'll load them in, calculate total weed biomass, and combind the dataframes
WintData1_tmp <- read.csv("https://ecommons.cornell.edu/server/api/core/bitstreams/adb24a0c-0b2c-4bd6-90ad-e203c270bba3/content")
WintData2_tmp <- read.csv("https://ecommons.cornell.edu/server/api/core/bitstreams/f05bf7b9-3c15-48ec-9f28-0c978cf0560b/content")

str(WintData1_tmp) #loaded in nicely
```

    ## 'data.frame':    40 obs. of  51 variables:
    ##  $ Trial               : chr  "COOP2" "COOP2" "COOP2" "COOP2" ...
    ##  $ Year                : int  2021 2021 2021 2021 2021 2021 2021 2021 2021 2021 ...
    ##  $ Site                : chr  "Farm Hub" "Farm Hub" "Farm Hub" "Farm Hub" ...
    ##  $ Block               : int  2 1 3 1 3 1 2 4 2 3 ...
    ##  $ Plot                : int  6 5 15 1 14 4 10 20 9 13 ...
    ##  $ CoverCrop           : chr  "HV" "HVxCR" "HV" "Tilled" ...
    ##  $ CoverCropBiomass    : num  302 432 343 0 NA ...
    ##  $ hairy.vetch         : num  302 189 343 0 NA ...
    ##  $ cereal.rye          : num  0 243 0 0 NA ...
    ##  $ canola              : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ common.chickweed    : num  0.65 1.12 0.03 27.98 NA ...
    ##  $ yellow.rocket       : num  52.6 2.81 14.72 259.63 NA ...
    ##  $ shepherd.s.purse    : num  0 0 0.94 0 NA 0 8.45 0.36 0 0 ...
    ##  $ purslane.speedwell  : num  0 0 0.05 0.52 NA 0 0.75 0 0 0 ...
    ##  $ horseweed           : num  0 0 0.21 3.84 NA 0.05 18.3 0.25 0 0.02 ...
    ##  $ annual.bluegrass    : num  0 0 0 11.5 NA ...
    ##  $ red.clover          : num  0 0 0 0.11 NA 0 0.11 0.03 0 0.01 ...
    ##  $ brassica.spp.       : num  0 0 0 0.03 NA 0 0 0 0 0 ...
    ##  $ yellow.foxtail      : num  0 0 0 0 NA 0 0.005 0 0 0 ...
    ##  $ curly.dock          : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ canada.thistle      : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ annual.ragweed      : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ mouseear.chickweed  : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ lady.s.thumb        : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ tree.spp            : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ thymeleaf.sandwort  : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ common.speedwell    : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ roughstalk.bluegrass: num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ black.medic         : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ dandelion           : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ giant.foxtail       : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ barnyard.grass      : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ yellow.woodsorrel   : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ yellow.nutsedge     : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ wild.mustard        : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ virginia.copperleaf : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ prostrate.knotweed  : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ wild.buckwheat      : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ witchgrass          : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ green.foxtail       : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ common.lambsquarters: num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ broadleaf.plantain  : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ persian.speedwell   : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ common.groundsel    : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ prickly.lettuce     : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ unknown_coop2_mus_1 : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ unknown_coop2_mus_2 : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ oat                 : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ corn.speedwell      : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ purple.deadnettle   : num  0 0 0 0 NA 0 0 0 0 0 ...
    ##  $ volunteer.cereal.rye: num  0 0 0 3.33 NA 0 34.3 0 0 0 ...

``` r
str(WintData2_tmp) #loaded in nicely
```

    ## 'data.frame':    40 obs. of  50 variables:
    ##  $ Trial                   : chr  "COOP4" "COOP4" "COOP4" "COOP4" ...
    ##  $ Year                    : int  2022 2022 2022 2022 2022 2022 2022 2022 2022 2022 ...
    ##  $ Site                    : chr  "Farm Hub" "Farm Hub" "Farm Hub" "Farm Hub" ...
    ##  $ Block                   : int  2 4 3 4 2 1 2 4 1 1 ...
    ##  $ Plot                    : int  8 20 13 18 10 4 9 16 3 2 ...
    ##  $ CoverCrop               : chr  "CR" "HVxCR" "Tilled" "HV" ...
    ##  $ CoverCropBiomass        : num  701 489 0 111 109 ...
    ##  $ canola                  : num  701 0 0 0 0 ...
    ##  $ cereal.rye              : num  0 413 0 0 0 ...
    ##  $ hairy.vetch             : num  0 75.1 0 110.9 109.3 ...
    ##  $ common.chickweed        : num  0 0.001 0.06 0 0 0.04 3.23 0 6.5 0 ...
    ##  $ volunteer.canola        : num  0 2.14 0.11 0 0 0 0 0 0 0 ...
    ##  $ wild.mustard            : num  0 0 87.1 68 47.7 ...
    ##  $ red.clover              : num  0 0 4.69 0.53 0.38 0 1.95 2.46 1.69 0 ...
    ##  $ roughstalk.bluegrass    : num  0 0 13.35 1.92 0.61 ...
    ##  $ large.crabgrass         : num  0 0 0.03 0 0 0 0.06 0.18 0 0 ...
    ##  $ green.foxtail           : num  0 0 0.06 0 0 0 0 0.001 0 0 ...
    ##  $ purslane.speedwell      : num  0.01 0 2.13 1.59 2.99 0.19 5.08 4.81 0.36 0 ...
    ##  $ horseweed               : num  0 0 2.38 1.08 0.06 ...
    ##  $ annual.fleabane         : num  0 0 1.04 0 0.2 0 0 0 0 0 ...
    ##  $ shepherd.s.purse        : num  0 0 0 3.54 0 2.36 15.4 2.32 2.28 0 ...
    ##  $ lady.s.thumb            : num  0 0 0 0 0.04 0 1.35 1.03 0 0 ...
    ##  $ white.clover            : num  0 0 0 0 0 0.001 0 0 0 0 ...
    ##  $ tall.fescue             : num  0 0 0 0 0 0 0.001 0 0 0 ...
    ##  $ yellow.foxtail          : num  0 0 0 0 0 0 0.001 0 0 0 ...
    ##  $ marsh.yellowcress       : num  0 0 0 0 0 0 0 0.84 0.16 0 ...
    ##  $ yellow.woodsorrel       : num  0 0 0 0 0 0 0 0.001 0 0 ...
    ##  $ yellow.rocket           : num  0 0 0 0 0 0 0 0 0.38 0 ...
    ##  $ giant.foxtail           : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ curly.dock              : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ common.lambsquarters    : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ pennsylvania.smartweed  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ powell.amaranth         : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ thymeleaf.sandwort      : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ mouseear.chickweed      : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ night.flowering.catchfly: num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ dandelion               : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ broadleaf.plantain      : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ persian.speedwell       : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ kentucky.bluegrass      : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ common.groundsel        : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ annual.ragweed          : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ wild.buckwheat          : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ yellow.nutsedge         : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ virginia.copperleaf     : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ venice.mallow           : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ canada.thistle          : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ annual.bluegrass        : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ poaceae.spp.            : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ prostrate.knotweed      : num  0 0 0 0 0 0 0 0 0 0 ...

``` r
#We don't want to do weed community analysis today, just simple models of total weed biomass
WintData1 <-
  WintData1_tmp %>% 
  rowwise() %>%
  mutate(WeedBiomass = sum(c_across(-c(Trial, Year, Site, Block, Plot, CoverCrop, CoverCropBiomass, canola, 
                                       cereal.rye, hairy.vetch)), na.rm = FALSE)) %>% 
  ungroup() %>% 
  select(Year, Site, Block, Plot, CoverCrop,WeedBiomass)

WintData2 <-
  WintData2_tmp %>% 
  rowwise() %>%
  mutate(WeedBiomass = sum(c_across(-c(Trial, Year, Site, Block, Plot, CoverCrop, CoverCropBiomass, canola, 
                                       cereal.rye, hairy.vetch)), na.rm = FALSE)) %>%
  ungroup() %>% 
  select(Year, Site, Block, Plot, CoverCrop,WeedBiomass)

#Combine data frames
WintData <- bind_rows(WintData1,WintData2)
```
